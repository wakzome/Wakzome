// TABLA PORTO SANTO
function renderPortoSanto(blocks, index) {
    const rows = blocks[index];
    const cols = Math.max(...rows.map(r => r.length));
    let html = '<table>';

    function findTodayCol(row) {
        const today = new Date();
        for (let c = 1; c < row.length; c++) {
            const d = row[c];
            if (!d) continue;
            const parts = d.split('/');
            if (parts.length !== 3) continue;
            const dateObj = new Date(+parts[2], +parts[1]-1, +parts[0]);
            if (dateObj.toDateString() === today.toDateString()) return c;
        }
        return -1;
    }

    const colWidths = Array(cols).fill(0);
    rows.forEach(r => r.forEach((c, i) => colWidths[i] = Math.max(colWidths[i], (c||'').length)));

    let i = 0;
    while (i < rows.length) {
        const row = rows[i];
        const firstCell = (row[0] || '').trim().toLowerCase();

        if (firstCell === 'porto santo') {
            html += '<tr>';
            html += `<th style="width:${colWidths[0]*12}px">${escapeHtml(row[0])}</th>`;
            for (let c = 1; c < cols; c++) {
                html += `<th style="width:${colWidths[c]*12}px">${escapeHtml(row[c] || '')}</th>`;
            }
            html += '</tr>';
            i++;
            continue;
        }

        const todayCol = findTodayCol(row);
        html += '<tr>';
        for (let c = 0; c < cols; c++) {
            const cls = (c === todayCol ? 'today-col' : '');
            html += `<th class="${cls}" style="width:${colWidths[c]*12}px">${escapeHtml(row[c] || '')}</th>`;
        }
        html += '</tr>';
        i++;

        while (i + 1 < rows.length && (rows[i][0] || '').toLowerCase() !== 'porto santo') {
            const A = rows[i];     // MaÃ±ana
            const B = rows[i + 1]; // Tarde

            html += '<tr>';

            // Columna de nombre
            let circleColor = 'red';
            if (todayCol > 0) {
                const horarios = [A[todayCol], B[todayCol]].filter(v => v);
                if (horarios.some(h => isNowInSchedule(h))) circleColor = 'green';
            }
            html += `<td class="name" style="white-space:nowrap;width:${colWidths[0]*12}px">
                        <span style="display:inline-block;width:12px;height:12px;border-radius:50%;background:${circleColor};margin-right:5px;"></span>
                        ${escapeHtml(A[0]||'')}
                     </td>`;

            // Columnas de horarios
            for (let c = 1; c < cols; c++) {
                const cls = (c === todayCol ? 'today-col' : '');
                const morning = (A[c] || '').trim().toUpperCase();
                const afternoon = (B[c] || '').trim().toUpperCase();

                let content = '';
                const specialWords = ['FOLGA', 'FERIAS']; // Palabras a mostrar solo 1 vez

                if (morning && morning === afternoon && specialWords.includes(morning)) {
                    content = `<div style="text-align:center">${escapeHtml(morning)}</div>`;
                } else if (morning && afternoon) {
                    content = `${escapeHtml(A[c])}<br>${escapeHtml(B[c])}`;
                } else {
                    content = escapeHtml(A[c] || B[c] || '');
                }

                html += `<td class="${cls}" style="width:${colWidths[c]*12}px; text-align:center;">${content}</td>`;
            }

            html += '</tr>';
            i += 2;
        }
    }

    html += '</table>';
    document.getElementById('table-container').innerHTML = html;
}
// TABLA PORTO SANTO
